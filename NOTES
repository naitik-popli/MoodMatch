USER A LOGS_______
[MATCH] Current queue length: 0
[MATCH] Cleaned up stale entries older than 2025-07-10T18:13:04.722Z
[DISCONNECT] Socket deZGz0Pio0LgpbjOAAAE disconnected (userId=undefined)
[MATCH] Current queue length: 0
[MATCH] Cleaned up stale entries older than 2025-07-10T18:13:09.714Z
[CONN Jwwmsu] New connection [socketId=Jwwmsuf554hI5Gk-AAAK]
[MATCH] Current queue length: 0
[MATCH] Cleaned up stale entries older than 2025-07-10T18:13:14.717Z
POST /api/session/create 200 23ms
Response: {
  "sessionId": 539,
  "userId": 423,
  "mood": "happy"
}
[CONN vXo2Qr] New connection [socketId=vXo2Qr9Icj26MS6oAAAN]
[2025-07-10T18:18:16.518Z] Generated new partnerId 1000423 for user 423
[2025-07-10T18:18:16.519Z] Generated new partnerId 1000423 for user 423
[2025-07-10T18:18:16.518Z] [SOCKET MAP] Bound user 423 to socket vXo2Qr9Icj26MS6oAAAN with partnerId 1000423
[2025-07-10T18:18:16.518Z] [SOCKET MAP] Current userSocketMap entry: userId=423, partnerId=1000423, socketId=vXo2Qr9Icj26MS6oAAAN
üí• Unhandled Rejection at: Promise {
  <rejected> PostgresError: duplicate key value violates unique constraint "user_socket_map_user_id_key"
      at ErrorResponse (file:///opt/render/project/src/node_modules/postgres/src/connection.js:794:26)
      at handle (file:///opt/render/project/src/node_modules/postgres/src/connection.js:480:6)
      at TLSSocket.data (file:///opt/render/project/src/node_modules/postgres/src/connection.js:315:9)
      at TLSSocket.emit (node:events:518:28)
      at addChunk (node:internal/streams/readable:561:12)
      at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
      at Readable.push (node:internal/streams/readable:392:5)
      at TLSWrap.onStreamRead (node:internal/stream_base_commons:189:23) {
    severity_local: 'ERROR',
    severity: 'ERROR',
    code: '23505',
    detail: 'Key (user_id)=(423) already exists.',
    schema_name: 'public',
    table_name: 'user_socket_map',
    constraint_name: 'user_socket_map_user_id_key',
    file: 'nbtinsert.c',
    line: '666',
    routine: '_bt_check_unique'
  }
} reason: PostgresError: duplicate key value violates unique constraint "user_socket_map_user_id_key"
    at ErrorResponse (file:///opt/render/project/src/node_modules/postgres/src/connection.js:794:26)
    at handle (file:///opt/render/project/src/node_modules/postgres/src/connection.js:480:6)
    at TLSSocket.data (file:///opt/render/project/src/node_modules/postgres/src/connection.js:315:9)
    at TLSSocket.emit (node:events:518:28)
    at addChunk (node:internal/streams/readable:561:12)
    at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
    at Readable.push (node:internal/streams/readable:392:5)
    at TLSWrap.onStreamRead (node:internal/stream_base_commons:189:23) {
  severity_local: 'ERROR',
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (user_id)=(423) already exists.',
  schema_name: 'public',
  table_name: 'user_socket_map',
  constraint_name: 'user_socket_map_user_id_key',
  file: 'nbtinsert.c',
  line: '666',
  routine: '_bt_check_unique'
}
[MATCH] Current queue length: 0
[MATCH] Cleaned up stale entries older than 2025-07-10T18:13:19.717Z
[2025-07-10T18:18:23.652Z] Generated new partnerId 1000423 for user 423
[2025-07-10T18:18:23.652Z] Generated new partnerId 1000423 for user 423
[2025-07-10T18:18:23.652Z] [SOCKET MAP] Bound user 423 to socket vXo2Qr9Icj26MS6oAAAN with partnerId 1000423
[2025-07-10T18:18:23.652Z] [SOCKET MAP] Current userSocketMap entry: userId=423, partnerId=1000423, socketId=vXo2Qr9Icj26MS6oAAAN
[2025-07-10T18:18:23.652Z] [SOCKET MAP] Bound user 423 to socket vXo2Qr9Icj26MS6oAAAN with partnerId 1000423
[2025-07-10T18:18:23.652Z] [SOCKET MAP] Current userSocketMap entry: userId=423, partnerId=1000423, socketId=vXo2Qr9Icj26MS6oAAAN
[2025-07-10T18:18:23.684Z] Generated new partnerId 1000423 for user 423
[2025-07-10T18:18:23.684Z] [SOCKET MAP] Bound user 423 to socket vXo2Qr9Icj26MS6oAAAN with partnerId 1000423
[2025-07-10T18:18:23.684Z] [SOCKET MAP] Current userSocketMap entry: userId=423, partnerId=1000423, socketId=vXo2Qr9Icj26MS6oAAAN
[2025-07-10T18:18:23.707Z] Generated new partnerId 1000423 for user 423
[2025-07-10T18:18:23.707Z] [SOCKET MAP] Bound user 423 to socket vXo2Qr9Icj26MS6oAAAN with partnerId 1000423
[2025-07-10T18:18:23.707Z] [SOCKET MAP] Current userSocketMap entry: userId=423, partnerId=1000423, socketId=vXo2Qr9Icj26MS6oAAAN
[QUEUE 423] Attempting to join queue for "happy" with socket vXo2Qr9Icj26MS6oAAAN
[QUEUE 423] Attempting to join queue for "happy" with socket vXo2Qr9Icj26MS6oAAAN
[QUEUE 423] Attempting to join queue for "happy" with socket vXo2Qr9Icj26MS6oAAAN
[QUEUE 423] Attempting to join queue for "happy" with socket vXo2Qr9Icj26MS6oAAAN
[QUEUE 423] Joined queue at position 1 for mood "happy"
[QUEUE 423] Joined queue at position 1 for mood "happy"
[QUEUE 423] Joined queue at position 1 for mood "happy"
[QUEUE 423] Joined queue at position 1 for mood "happy"
[MATCH] Current queue length: 1
[MATCH] Current queue length: 1
[MATCH] Current queue length: 1
[MATCH] Current queue length: 1
[MATCH] Cleaned up stale entries older than 2025-07-10T18:13:24.052Z
[MATCH] Cleaned up stale entries older than 2025-07-10T18:13:24.053Z
[MATCH] Cleaned up stale entries older than 2025-07-10T18:13:24.054Z
[MATCH] Cleaned up stale entries older than 2025-07-10T18:13:24.054Z
[MATCH] Current queue length: 1
[MATCH] Cleaned up stale entries older than 2025-07-10T18:13:24.718Z
[MATCH] Current queue length: 1
[MATCH] Cleaned up stale entries older than 2025-07-10T18:13:29.722Z


USER B LOGS_______
üîó Socket connection status: true
index-CBFnVS9r.js:363 üì∫ Render check: {currentScreen: 'call', selectedMood: 'happy', sessionData: {‚Ä¶}}
index-CBFnVS9r.js:319 üßπ Component unmounted, but socket connection kept alive
index-CBFnVS9r.js:319 [WaitingRoom] Emitting leave-mood-queue for user 421
index-CBFnVS9r.js:319 üåê API_BASE_URL: https://moodmatch-61xp.onrender.com/api
index-CBFnVS9r.js:319 üîß Constructed wsUrl: wss://moodmatch-61xp.onrender.com
index-CBFnVS9r.js:319 üöÄ Connecting to socket at: wss://moodmatch-61xp.onrender.com
index-CBFnVS9r.js:319 [2025-07-10T15:24:07.353Z] [DEBUG:VideoCall] Waiting for socket, media permissions, or partnerSocketId {socketReady: false, mediaPermissionGranted: false, partnerSocketId: '9Yv6_zBwuiRGb8mRAAAT'}
index-CBFnVS9r.js:363 üìû Transitioning to VideoCall: {sessionId: 537, userId: 421, partnerId: 422, partnerSocketId: '9Yv6_zBwuiRGb8mRAAAT'}
index-CBFnVS9r.js:319 [2025-07-10T15:24:07.358Z] [DEBUG:VideoCall] Waiting for socket, media permissions, or partnerSocketId {socketReady: true, mediaPermissionGranted: false, partnerSocketId: '9Yv6_zBwuiRGb8mRAAAT'}
index-CBFnVS9r.js:319 [2025-07-10T15:24:07.671Z] [DEBUG:VideoCall] Starting call initialization
index-CBFnVS9r.js:319 [WEBRTC] Media already initialized, skipping...
index-CBFnVS9r.js:319 [WEBRTC] Creating new peer connection
index-CBFnVS9r.js:319 [WEBRTC] Signaling state: have-local-offer
index-CBFnVS9r.js:319 [WEBRTC] Created and set local description with offer
index-CBFnVS9r.js:319 [WEBRTC] Sent offer to 422
index-CBFnVS9r.js:319 [2025-07-10T15:24:07.812Z] [DEBUG:VideoCall] Call started successfully
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:1510940612 1 udp 2122194687 100.93.64.62‚Ä¶106 typ host generation 0 ufrag Kj8n network-id 1', sdpMid: '0', sdpMLineIndex: 0, foundation: '1510940612', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:2059754257 1 udp 2122129151 192.168.1.20‚Ä¶eration 0 ufrag Kj8n network-id 3 network-cost 10', sdpMid: '0', sdpMLineIndex: 0, foundation: '2059754257', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:1769131686 1 udp 2122265343 fd7a:115c:a1‚Ä¶348 typ host generation 0 ufrag Kj8n network-id 2', sdpMid: '0', sdpMLineIndex: 0, foundation: '1769131686', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:1510940612 1 udp 2122194687 100.93.64.62‚Ä¶694 typ host generation 0 ufrag Kj8n network-id 1', sdpMid: '1', sdpMLineIndex: 1, foundation: '1510940612', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:2059754257 1 udp 2122129151 192.168.1.20‚Ä¶eration 0 ufrag Kj8n network-id 3 network-cost 10', sdpMid: '1', sdpMLineIndex: 1, foundation: '2059754257', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:1769131686 1 udp 2122265343 fd7a:115c:a1‚Ä¶415 typ host generation 0 ufrag Kj8n network-id 2', sdpMid: '1', sdpMLineIndex: 1, foundation: '1769131686', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Local media stream initialized MediaStream¬†{id: '550b9499-a3a9-4eae-8891-6f5020beac08', active: true, onaddtrack: null, onremovetrack: null, onactive: null,¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Peer connection already exists, reusing it.
index-CBFnVS9r.js:319 [WEBRTC] Added local track (initiator) MediaStreamTrack¬†{kind: 'audio', id: '9be2863d-6ba8-4d55-ab46-4a15a623ff55', label: 'Default', enabled: true, muted: false,¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Added local track (initiator) MediaStreamTrack¬†{kind: 'video', id: '0950be87-e0ba-4808-b633-c55e9439e8eb', label: 'Droidcam', enabled: true, muted: false,¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:3582966319 1 udp 1685921535 103.87.58.18‚Ä¶eration 0 ufrag Kj8n network-id 3 network-cost 10', sdpMid: '0', sdpMLineIndex: 0, foundation: '3582966319', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:3582966319 1 udp 1685921535 103.87.58.18‚Ä¶eration 0 ufrag Kj8n network-id 3 network-cost 10', sdpMid: '1', sdpMLineIndex: 1, foundation: '3582966319', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:2762328912 1 tcp 1518214911 100.93.64.62‚Ä¶ptype active generation 0 ufrag Kj8n network-id 1', sdpMid: '0', sdpMLineIndex: 0, foundation: '2762328912', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:2221903749 1 tcp 1518149375 192.168.1.20‚Ä¶eration 0 ufrag Kj8n network-id 3 network-cost 10', sdpMid: '0', sdpMLineIndex: 0, foundation: '2221903749', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:2547522098 1 tcp 1518285567 fd7a:115c:a1‚Ä¶ptype active generation 0 ufrag Kj8n network-id 2', sdpMid: '0', sdpMLineIndex: 0, foundation: '2547522098', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:2762328912 1 tcp 1518214911 100.93.64.62‚Ä¶ptype active generation 0 ufrag Kj8n network-id 1', sdpMid: '1', sdpMLineIndex: 1, foundation: '2762328912', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:2221903749 1 tcp 1518149375 192.168.1.20‚Ä¶eration 0 ufrag Kj8n network-id 3 network-cost 10', sdpMid: '1', sdpMLineIndex: 1, foundation: '2221903749', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:2547522098 1 tcp 1518285567 fd7a:115c:a1‚Ä¶ptype active generation 0 ufrag Kj8n network-id 2', sdpMid: '1', sdpMLineIndex: 1, foundation: '2547522098', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Created and set local description with offer
index-CBFnVS9r.js:319 [WEBRTC] Sent offer to 422
index-CBFnVS9r.js:319 [WEBRTC] Media already initialized, skipping...
index-CBFnVS9r.js:319 [WEBRTC] Creating new peer connection
index-CBFnVS9r.js:319 [WEBRTC] Added local track (initiator) MediaStreamTrack¬†{kind: 'audio', id: '9be2863d-6ba8-4d55-ab46-4a15a623ff55', label: 'Default', enabled: true, muted: false,¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Added local track (initiator) MediaStreamTrack¬†{kind: 'video', id: '0950be87-e0ba-4808-b633-c55e9439e8eb', label: 'Droidcam', enabled: true, muted: false,¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Signaling state: have-local-offer
index-CBFnVS9r.js:319 [WEBRTC] Created and set local description with offer
index-CBFnVS9r.js:319 [WEBRTC] Sent offer to 422
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:1036402566 1 udp 2122194687 100.93.64.62‚Ä¶111 typ host generation 0 ufrag O6yj network-id 1', sdpMid: '0', sdpMLineIndex: 0, foundation: '1036402566', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:2550618611 1 udp 2122129151 192.168.1.20‚Ä¶eration 0 ufrag O6yj network-id 3 network-cost 10', sdpMid: '0', sdpMLineIndex: 0, foundation: '2550618611', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:1124776171 1 udp 2122265343 fd7a:115c:a1‚Ä¶475 typ host generation 0 ufrag O6yj network-id 2', sdpMid: '0', sdpMLineIndex: 0, foundation: '1124776171', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:1036402566 1 udp 2122194687 100.93.64.62‚Ä¶662 typ host generation 0 ufrag O6yj network-id 1', sdpMid: '1', sdpMLineIndex: 1, foundation: '1036402566', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:2550618611 1 udp 2122129151 192.168.1.20‚Ä¶eration 0 ufrag O6yj network-id 3 network-cost 10', sdpMid: '1', sdpMLineIndex: 1, foundation: '2550618611', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:1124776171 1 udp 2122265343 fd7a:115c:a1‚Ä¶425 typ host generation 0 ufrag O6yj network-id 2', sdpMid: '1', sdpMLineIndex: 1, foundation: '1124776171', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:1124719902 1 tcp 1518214911 100.93.64.62‚Ä¶ptype active generation 0 ufrag O6yj network-id 1', sdpMid: '0', sdpMLineIndex: 0, foundation: '1124719902', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:3871914859 1 tcp 1518149375 192.168.1.20‚Ä¶eration 0 ufrag O6yj network-id 3 network-cost 10', sdpMid: '0', sdpMLineIndex: 0, foundation: '3871914859', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:1036343923 1 tcp 1518285567 fd7a:115c:a1‚Ä¶ptype active generation 0 ufrag O6yj network-id 2', sdpMid: '0', sdpMLineIndex: 0, foundation: '1036343923', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:1124719902 1 tcp 1518214911 100.93.64.62‚Ä¶ptype active generation 0 ufrag O6yj network-id 1', sdpMid: '1', sdpMLineIndex: 1, foundation: '1124719902', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:3871914859 1 tcp 1518149375 192.168.1.20‚Ä¶eration 0 ufrag O6yj network-id 3 network-cost 10', sdpMid: '1', sdpMLineIndex: 1, foundation: '3871914859', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:1036343923 1 tcp 1518285567 fd7a:115c:a1‚Ä¶ptype active generation 0 ufrag O6yj network-id 2', sdpMid: '1', sdpMLineIndex: 1, foundation: '1036343923', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:3640470362 1 udp 1685921535 103.87.58.18‚Ä¶eration 0 ufrag O6yj network-id 3 network-cost 10', sdpMid: '0', sdpMLineIndex: 0, foundation: '3640470362', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] Sending ICE candidate RTCIceCandidate¬†{candidate: 'candidate:3640470362 1 udp 1685921535 103.87.58.18‚Ä¶eration 0 ufrag O6yj network-id 3 network-cost 10', sdpMid: '1', sdpMLineIndex: 1, foundation: '3640470362', component: 'rtp',¬†‚Ä¶}
index-CBFnVS9r.js:319 [WEBRTC] ICE connection state: checking